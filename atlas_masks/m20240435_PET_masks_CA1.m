clear 
close all
clc
%% Load atlas

% path to MRI template - must include hdr and img files
atlas = niftiread('/Users/jstrohl/Documents/20230908 Pipelines for neural data analysis/Dependencies/ATLAS-MICE 2/2011-10-30_MRI-template3.hdr', ...
        '/Users/jstrohl/Documents/20230908 Pipelines for neural data analysis/Dependencies/ATLAS-MICE 2/2011-10-30_MRI-template3.img');

save_path = '/Users/jstrohl/Desktop/20231108 Strohl Sepsis fear network/20240425 Atlas'
save_name = 'CA1'

save_flag = 1;

%% Define atlas-based regions to analyze

% column 1 is left column 2 is right

% CA1

regions = cell(15,2);
regions{1,1} = [98 49;103 50;106 53;109 59;111 65;111 71;106 79;104 73;105 66;103 58;101 53]; %i=114
regions{2,1} = [97 48;102 48;106 52;109 57;111 64;111 71;106 79;103 73;105 66;103 58;101 53];%i=113
regions{3,1} = [95 45;102 47;107 52;109 57;111 64;111 71;106 79;103 73;105 63;103 55;100 50];%i=112
regions{4,1} = [94 44;99 45;104 48;109 57;111 64;111 71;106 79;103 73;105 63;103 55;100 50];%i=111
regions{5,1} = [94 44;99 45;104 47;110 56;112 64;111 71;106 79;103 73;105 63;103 55;100 50];%i=110
regions{6,1} = [93 42;97 42;104 47;110 56;112 63;111 71;106 79;104 72;106 63;103 55;100 50];%i=109
regions{7,1} = [92 42;98 42;104 46;110 55;112 63;111 71;104 80;102 72;105 63;103 55;100 50];%i=108
regions{8,1} = [91 40;98 41;104 46;110 55;112 63;111 71;103 80;102 72;105 63;103 55;100 50];%i=107
regions{9,1} = [91 40;98 41;105 45;110 55;112 63;111 71;103 80;100 72;105 64;103 55;100 50];%i=106
regions{10,1} = [91 39;98 41;105 45;110 55;112 63;111 71;103 80;100 72;105 64;103 55;100 50];%i=105
regions{11,1} = [90 37;97 39;105 45;110 55;112 63;110 71;102 80;100 73;105 64;103 55;100 50];%i=104
regions{12,1} = [90 37;97 39;105 45;110 55;112 63;110 71;102 80;100 73;105 64;103 55;100 50];%i=103
regions{13,1} = [89 36;97 39;105 45;110 55;112 63;110 71;103 77;101 73;106 63;103 55;97 46];%i=102
regions{14,1} = [89 36;97 39;105 45;110 55;112 63;110 71;103 77;101 73;106 63;103 55;97 46];%i=101
regions{15,1} = [86 32;96 36;105 44;111 54;112 63;110 69;104 75;102 71;106 63;103 53;97 45];%i=100


regions{1,2} = [98 123;103 122;106 119;109 113;111 107;111 101;106 93;104 99;105 106;103 114;101 119];%slice=114
regions{2,2} = [97 124;102 124;106 120;109 115;111 108;111 101;106 93;103 99;105 106;103 114;101 119];%slice=113
regions{3,2} = [95 127;102 125;107 120;109 115;111 108;111 101;106 93;103 99;105 109;103 117;100 122];%slice=112
regions{4,2} = [94 128;99 127;104 124;109 115;111 108;111 101;106 93;103 99;105 109;103 117;100 122];%slice=111
regions{5,2} = [94 128;99 127;104 125;110 116;112 108;111 101;106 93;103 99;105 109;103 117;100 122];%slice=110
regions{6,2} = [93 128;97 127;104 125;110 116;112 108;111 101;106 93;104 99;106 109;103 117;100 122];%slice=109
regions{7,2} = [92 130;98 130;104 126;110 117;112 109;111 101;104 92;102 100;105 109;103 117;100 122];%slice=108
regions{8,2} = [91 130;98 130;105 126;110 117;112 109;111 101;103 92;100 100;105 109;103 117;100 122];%slice=107
regions{9,2} = [91 130;98 130;105 126;110 117;112 109;111 101;103 92;100 100;105 109;103 117;100 122];%slice=106
regions{10,2} = [91 133;98 131;105 127;110 117;112 109;111 101;103 92;100 100;105 108;103 117;100 122];%slice=105
regions{11,2} = [90 135;97 133;105 127;110 117;112 109;110 101;102 92;100 99;105 108;103 117;100 122];%slice=104
regions{12,2} = [90 135;97 133;105 127;110 117;112 109;110 101;102 92;100 99;105 108;103 117;100 122];%slice=103
regions{13,2} = [89 136;97 133;105 127;110 117;112 109;110 101;103 95;101 99;106 109;103 117;97 126];%slice=102
regions{14,2} = [89 136;97 133;105 127;110 117;112 109;110 101;103 95;101 99;106 109;103 117;97 126];%slice=101
regions{15,2} = [86 140;96 136;105 128;111 118;112 109;110 103;104 97;102 101;106 109;103 119;97 127];%slice=100


%% Show atlas and roi for each slice

slice_counter = 1;
slice_num = 114;
while slice_num >= 100
    figure
    atlas_view = reshape(atlas(:,slice_num,:),[165,135]);
    imshow(atlas_view,[0,max(atlas_view,[],'all')])
    roi = images.roi.Freehand(gca,'Position',regions{slice_counter,1});
    set(gcf,'Position',[100,100,1800,1000])
    if save_flag == 1
        print(gcf,sprintf('%s/%s_left_%d.tiff',save_path,save_name,slice_num),'-dtiff','-r300')
    end
    figure
    atlas_view = reshape(atlas(:,slice_num,:),[165,135]);
    imshow(atlas_view,[0,max(atlas_view,[],'all')])
    roi = images.roi.Freehand(gca,'Position',regions{slice_counter,2});
    set(gcf,'Position',[100,100,1800,1000])
    if save_flag == 1
        print(gcf,sprintf('%s/%s_right_%d.tiff',save_path,save_name,slice_num),'-dtiff','-r300')
    end
    slice_counter = slice_counter + 1;
    slice_num = slice_num - 1;
end

